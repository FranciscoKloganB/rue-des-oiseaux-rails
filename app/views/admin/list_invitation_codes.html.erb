<section class="py-6 px-2 md:px-4 lg:px-6 mx-auto max-w-7xl space-y-6">
  <header class="px-2 md:px-0">
    <h1 class="text-3xl font-bold text-base-content">Invitation Codes</h1>
    <p class="text-base-content/70">Generate, send, and review invitation codes in one place.</p>
  </header>

  <% flash.each do |type, message| %>
    <% next if message.blank? %>
    <div
      role="alert"
      class="alert alert-vertical sm:alert-horizontal shadow-lg <%= type == "notice" ? "alert-success" : "alert-error" %>"
    >
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current h-6 w-6 shrink-0">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <span><%= message %></span>
      <div class="flex gap-2">
        <button
          type="button"
          class="btn btn-sm"
          onclick="this.closest('.alert').remove()"
          aria-label="Dismiss alert"
        >
          Dismiss
        </button>
      </div>
    </div>
  <% end %>

  <%= render "admin/create_invitation_codes", status: @status %>

  <div class="card bg-base-100 shadow-xl">
    <div class="card-body space-y-4">
      <% status_label = (@status == "all" ? "total" : @status) %>
      <div class="flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between">
        <div>
          <h2 class="card-title">Existing Codes</h2>
          <p class="text-sm text-base-content/70">
            Showing <%= @invitation_codes.size %> of <%= @total_count %> <%= status_label %> invitation codes.
          </p>
        </div>

        <div class="join">
          <% filters = { "active" => "Active", "deleted" => "Deleted", "all" => "All" } %>
          <% filters.each do |value, label| %>
            <%= link_to label,
                        admin_invitation_codes_path(status: value),
                        class: "btn join-item #{'btn-primary' if @status == value}" %>
          <% end %>
        </div>
      </div>

      <div class="overflow-x-auto">
        <table class="table table-zebra">
          <thead>
            <tr>
              <th>Token</th>
              <th>Sent</th>
              <th>Created at</th>
              <th>Deleted at</th>
              <th class="text-right">Actions</th>
            </tr>
          </thead>
          <tbody>
            <% if @invitation_codes.any? %>
              <%= render partial: "admin/invitation_code_row",
                         collection: @invitation_codes,
                         as: :code,
                         locals: { current_page: @page, current_status: @status } %>
            <% else %>
              <tr>
                <td colspan="5" class="text-center text-base-content/70">
                  No <%= status_label %> invitation codes found.
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>

      <div class="flex justify-end">
        <div class="join">
          <% prev_disabled = @page <= 1 %>
          <%= link_to(prev_disabled ? "#" : admin_invitation_codes_path(page: @page - 1, status: @status),
                      class: "btn join-item #{prev_disabled ? 'btn-disabled' : 'btn-outline'}",
                      aria: { disabled: prev_disabled },
                      data: (prev_disabled ? { turbo: false } : {})) do %>
            Previous
          <% end %>

          <% next_disabled = @page >= @total_pages %>
          <%= link_to(next_disabled ? "#" : admin_invitation_codes_path(page: @page + 1, status: @status),
                      class: "btn join-item #{next_disabled ? 'btn-disabled' : 'btn-outline'}",
                      aria: { disabled: next_disabled },
                      data: (next_disabled ? { turbo: false } : {})) do %>
            Next
          <% end %>
        </div>
      </div>
    </div>
  </div>
</section>

